# Submit Functionality Removal Plan

## Overview
Since a dedicated submit app now exists for uploading files to the analyzer, this plan outlines the removal of the submit/upload-to-GitHub functionality from the analyzer app to reduce clutter and avoid duplicate functionality.

## ⚠️ CRITICAL - DO NOT REMOVE ⚠️

The following are **CORE FUNCTIONALITY** for the analyzer app and must NOT be touched:

### 1. Manual File Upload Feature
- **All UI in App.jsx** related to loading local JSON files
- `handleManualFileUpload` function
- `uploadedFilesCollapsed` state
- Manual File Upload UI sections (lines ~4473-4700)
- `Upload` icon imports from lucide-react
- **Purpose:** Loads local JSON files into browser for analysis

### 2. BR Data Structure Files
- **`public/br-data-structure.json`** - KEEP THIS FILE!
  - Generated by `scripts/generate-br-data-structure.js`
  - Used by `BRDataSelector.jsx` to browse BR_Data folders
  - Critical for file selection in the analyzer
  - Has NOTHING to do with GitHub submission

### 3. Build Scripts
- **`scripts/generate-br-data-structure.js`** - KEEP
- **`scripts/br-data-api-server.js`** - KEEP (dev server)
- **`scripts/watch-br-data.js`** - KEEP

---

## What TO REMOVE

**REMOVE:** The "Submit Data to GitHub" functionality that creates Pull Requests using the GitHub Device Flow.

---

## Files to Remove

### 1. Core Upload Components (DELETE)
- **`src/UploadPanel.jsx`** (582 lines)
  - Main upload UI component with GitHub PR submission logic
  - Contains team data settings, file validation, and PR creation
  - Handles communication with backend validation and submission APIs
  
- **`src/UploadWidgetLauncher.jsx`** (~70 lines)
  - Floating "Submit Data" button launcher
  - Creates portal for UploadPanel modal
  - Handles positioning logic to avoid AI modal conflicts

- **`src/githubDeviceFlow.js`** (192 lines)
  - GitHub OAuth Device Flow implementation
  - Functions: `startDeviceFlow`, `pollForToken`, `getCurrentUser`, `getBranchSHA`, `createBranch`, `uploadFile`, `openPullRequest`
  - Config helpers for GitHub Client ID, Owner, Repo, Base Branch

### 2. API/Backend Integration (DELETE)
- **`src/api/br-data-structure.js`** (14 lines)
  - **NOTE:** This is NOT the same as `public/br-data-structure.json` (which we keep!)
  - This is an unused server-side API endpoint
  - Was intended for upload panel to populate folder dropdowns
  - Never actually imported or used anywhere
  - The static JSON file in `public/` is what's actually used

---

## Files to Modify

### 1. Main Entry Point
**File:** `src/main.jsx`

**Changes:**
- Remove import: `import UploadWidgetLauncher from './UploadWidgetLauncher.jsx';`
- Remove render: `<UploadWidgetLauncher />` from JSX
- **IMPORTANT:** Remove the entire config.json loading block (lines 14-35) - this is ONLY used by githubDeviceFlow.js which is being removed

**Lines affected:** ~25 lines total

---

### 2. App Component
**File:** `src/App.jsx`

**Changes:**
- Remove import: `import UploadWidgetLauncher from './UploadWidgetLauncher';` (line 53)
- **CRITICAL:** Remove the exported function `UploadWidgetMount` (lines 8241-8243):
  ```jsx
  // Mount helper: render the UploadWidgetLauncher near root of the app
  export function UploadWidgetMount({ darkMode = false }) {
    return <UploadWidgetLauncher darkMode={darkMode} />;
  }
  ```
  - This function is exported but NEVER USED anywhere in the codebase
  - Safe to remove
  
**Important - DO NOT TOUCH:**
- Keep all `Upload` icon imports from lucide-react
- Keep `uploadedFilesCollapsed` state
- Keep `handleManualFileUpload` function
- Keep Manual File Upload UI sections (lines ~4473-4700)
- These are for LOCAL file selection, not GitHub submission

**Lines affected:** ~5 lines total

---

### 3. Build Configuration
**File:** `vite.config.js`

**Changes:**
- Remove proxy configuration for `/api` endpoints:
```javascript
proxy: {
  '/api': {
    target: 'https://sparking-zero-iota.vercel.app',
    changeOrigin: true
  }
}
```
- This was used to proxy validation and submit API calls
- No longer needed without upload functionality

**Lines affected:** ~6 lines

---

## Configuration Files to Remove/Clean

### 1. Environment Variables
**File:** `.env.local` (DELETE or document as obsolete)

**Current content:**
```
VITE_GITHUB_CLIENT_ID=Ov23lig3PpP4my1WvuEJ
VITE_GITHUB_OWNER=DragonBallZLeague
VITE_GITHUB_REPO=SparkingZero
VITE_GITHUB_BASE_BRANCH=dev-branch
```

**Action:** Since these are only used by githubDeviceFlow.js (which will be deleted), this file can be removed entirely OR kept with a comment explaining it's obsolete.

---

### 2. Public Runtime Config
**File:** `public/config.json`

**Current content:**
```json
{
  "GITHUB_CLIENT_ID": "Ov23lig3PpP4my1WvuEJ",
  "OWNER": "DragonBallZLeague",
  "REPO": "SparkingZero",
  "BASE_BRANCH": "dev-branch",
  "DEVICE_PROXY_BASE": "https://sparking-zero-chi.vercel.app"
}
```

**Action:** DELETE this file entirely
- Loaded by main.jsx lines 14-35
- Stored in `window.__SZ_CONFIG__`
- ONLY used by githubDeviceFlow.js (which is being deleted)
- No other references found in the codebase

**VERIFIED:** Not used elsewhere - safe to delete

---

### 3. Static BR Data Structure File
**File:** `p⛔ **DO NOT DELETE - CORE FILE** ⛔

This file is CRITICAL for analyzer functionality:
- Generated by `scripts/generate-br-data-structure.js` during build (prebuild script)
- Loaded by `BRDataSelector.jsx` (line 141) to display folder structure
- Used for browsing and selecting which BR_Data files to analyze
- Has ZERO connection to GitHub upload/submit functionality
- **Deleting this will break the entire file selection system**

**Confusion Warning:** Despite similar naming to `src/api/br-data-structure.js` (which we ARE deleting), these are completely different files with different purposes.ta files to analyze
- Has NOTHING to do with upload functionality
- Critical for app functionality

---

## Documentation to Update

### 1. Main README
**File:** `README.md`

**Sections to remove:**
- Lines 41-54: "Submit Data (GitHub-only)" section
- Lines 57-96: "In-App Uploads (GitHub Device Flow)" section

**Sections to keep:**
- All analyzer feature documentation
- Manual file loading instructions
- Development setup

**Replacement text suggestion:**
```markdown
## Submit Data

To submit battle result data to the league database, please use the dedicated [Submit App](../submit/README.md).

The analyzer app focuses on data analysis and visualization. Data submission is handled separately.
```

---

### 2. Upload-Specific Documentation
**File:** `docs/MULTIPLE_FILE_UPLOAD_FIXES.md`

**Action:** KEEP this file - it documents LOCAL file upload for analysis, not GitHub submission

**Note:** This is confusing naming but the content is about manual file selection for analysis

---

## Dependencies to Review

## Dependencies to Review

### Package.json
**File:** `package.json`

**Review:** Check if any dependencies were specifically added for upload functionality:
- No obvious GitHub/OAuth specific dependencies found
- All current dependencies appear to be for analysis features
- **Action:** No changes needed

---

## Backend API Files (Outside analyzer app)

### These are referenced but live elsewhere:
- `vercel-api/api/submit.js` - GitHub PR submission logic
- `vercel-api/api/validate.js` - File validation
- `vercel-api/api/paths.js` - Path structure endpoint

**Action:** These should remain for the submit app to use. NO CHANGES to these files.

---

## Verification Results ✅

All files and code have been checked for external references in both the analyzer app AND the submit app:

### Safe to Delete:
| Item | Status | Verification |
|------|--------|--------------|
| `src/UploadPanel.jsx` | ✅ Safe | Only imported by UploadWidgetLauncher.jsx |
| `src/UploadWidgetLauncher.jsx` | ✅ Safe | Used in main.jsx (line 4, 10) and App.jsx (line 53, 8241-8243) - all will be removed |
| `src/githubDeviceFlow.js` | ✅ Safe | No imports found anywhere |
| `src/api/br-data-structure.js` | ✅ Safe | Never imported, unused API endpoint (NOT the same as public/ version!) |
| `public/config.json` | ✅ Safe | Only loaded by main.jsx for GitHub config |
| `.env.local` | ✅ Safe | Only read by githubDeviceFlow.js |
| `UploadWidgetMount` function | ✅ Safe | Exported but never used |
| `window.__SZ_CONFIG__` loading | ✅ Safe | Only used by githubDeviceFlow.js |
| API proxy in vite.config.js | ✅ Safe | Only used by UploadPanel for submit endpoints |

### ⛔ DO NOT DELETE - CORE FILES:
| File | Why It's Critical |
|------|-------------------|
| `public/br-data-structure.json` | Used by BRDataSelector.jsx for browsing BR_Data files |
| Manual file upload UI in App.jsx | Local file loading for analysis (NOT GitHub submission) |
| `scripts/generate-br-data-structure.js` | Builds the br-data-structure.json file |
| `scripts/br-data-api-server.js` | Dev server for API testing |

---

## Submit App Independence Verification ✅

The submit app (`apps/submit/`) has been checked and is **completely independent**:

### Submit App Uses Its Own:
- ✅ `js/config.js` - Own configuration with hardcoded API URL
- ✅ `js/api.js` - Direct calls to vercel-api endpoints
- ✅ `js/teamData.js` - Own team list
- ✅ `js/validation.js` - Own validation logic
- ✅ Static HTML/CSS/JS - No build process, no Vite, no React

### Submit App Does NOT Use:
- ✅ No imports from analyzer app
- ✅ No references to `UploadPanel.jsx`
- ✅ No references to `UploadWidgetLauncher.jsx`
- ✅ No references to `githubDeviceFlow.js`
- ✅ No use of analyzer's `.env.local` or `config.json`
- ✅ No VITE_ environment variables
- ✅ No shared React components

### Only Connection:
- README.md line 81: Documentation link to analyzer (harmless reference)

**CONCLUSION:** Deleting analyzer's GitHub submission files will NOT affect the submit app.

---

## Summary of Changes

### Files to DELETE (6 files only - verified safe):
1. `src/UploadPanel.jsx` (582 lines)
2. `src/UploadWidgetLauncher.jsx` (~70 lines)
3. `src/githubDeviceFlow.js` (192 lines)
4. `src/api/br-data-structure.js` (14 lines) - ⚠️ NOT the public/ version!
5. `public/config.json` (7 lines)
6. `.env.local` (9 lines)

**Double-Check Before Deleting:**
- ✅ `src/api/br-data-structure.js` - YES, delete this (unused API endpoint)
- ⛔ `public/br-data-structure.json` - NO, keep this (core functionality)

**Double-Check Before Deleting:**
- ✅ `src/api/br-data-structure.js` - YES, delete this (unused API endpoint)
- ⛔ `public/br-data-structure.json` - NO, keep this (core functionalitycher.jsx` (~70 lines)
3. `src/githubDeviceFlow.js` (192 lines)
4. `src/api/br-data-structure.js` (14 lines)
5. `public/config.json` (7 lines)
6. `.env.local` (9 lines)

### Files to MODIFY (3 files):
1. `src/main.jsx` - Remove UploadWidgetLauncher import/render + config loading (~25 lines)
2. `src/App.jsx` - Remove UploadWidgetLauncher import + UploadWidgetMount function (~5 lines)
3. `vite.config.js` - Remove API proxy configuration (~6 lines)

### Files to UPDATE (1 file):
1. `README.md` - Update documentation sections about data submission (~35 lines)

### Total Impact:
- **~910 lines of code removed**
- **~36 lines of code modified**
- **6 files deleted**
- **Cleaner architecture** - analyzer focuses on analysis, submit app handles submissions
- **Less maintenance burden** - one place to update submission logic
- **Smaller bundle size** - removed GitHub OAuth +
5. `public/config.json` (optional - verify not used elsewhere)
6. `.env.local` (optional - can document as obsolete)

### Files to MODIFY (3 files):
1. `src/main.jsx` - Remove UploadWidgetLauncher import and render
2. `src/App.jsx` - Remove unused UploadWidgetLauncher import
3. `vite.config.js` - Remove API proxy configuration

### Files to UPDATE (1 file):
1. `README.md` - Update documentation sections about data submission

### Total Impact:
- **~870 lines of code removed**
- **~15 lines of code modified**
- **Cleaner architecture** - analyzer focuses on analysis, submit app handles submissions
- **Less maintenance burden** - one place to update submission logic

---

## Testing Checklist After Removal

- [ ] App builds successfully (`npm run build`)
- [ ] App runs in dev mode (`npm run dev`)
- [ ] Manual file upload still works (local JSON loading)
- [ ] File selection UI displays properly
- [ ] Single match analysis works with manually loaded files
- [ ] Multi-file analysis works with manually loaded files
- [ ] No console errors related to missing components
- [ ] No references to removed components in remaining code
- [ ] Documentation accurately reflects current functionality

---

## Rollback Plan

If removal causes unexpected issues:
1. All removed code is tracked in git history
2. Can revert specific commits
3. Can cherry-pick back individual files if needed

---

## Notes

- The analyzer's "Manual File Upload" feature is **completely separate** from GitHub submission
- Manual file upload loads JSON files into browser memory for analysis
- GitHub submission (being removed) created PRs with new data files
- These are two different user workflows with similar naming

